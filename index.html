<script>
  ;(async () => {
    const textDecoder = new TextDecoder()

    const env = {
      print (str, len) {
        const buf = wasm.instance.exports.memory.buffer.slice(str, str + len)
        const text = textDecoder.decode(buf)
        const pre = document.createElement('pre')
        pre.innerText = text
        document.body.appendChild(pre)
        console.log(text)
      }
    }

    const wasm = (window.wasm = await WebAssembly.instantiateStreaming(
      fetch('out.wasm'),
      { env }
    ))

    console.log("type 'wasm' to explore the wasm module")
    console.log(wasm.instance.exports.main())
  })()
</script>
